<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Attendance History</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --green-bg: #d4edda;
      --green-text: #155724;
      --red-bg:   #f8d7da;
      --red-text: #721c24;
      --amber-bg: #fff3cd;
      --amber-text:#856404;
    }

    body { font-family: system-ui, sans-serif; margin: 1rem; }
    h1 { margin: 0 0 .5rem; }
    nav a { text-decoration: none; }
    hr { margin: .75rem 0 1rem; }

    form.filters { display: grid; gap: 10px; max-width: 720px;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); margin-bottom: .5rem; }
    label { font-size: 1rem; display: flex; flex-direction: column; gap: 6px; }
    select { font-size: 1.05rem; padding: 10px; border-radius: 6px; width: 100%; }

    .counts { margin: .5rem 0 1rem; font-size: .95rem; }
    .counts span { margin-right: 14px; }

    ul { list-style: none; padding: 0; margin: 0; }
    li { font-size: 1rem; display: flex; flex-direction: column; padding: 10px; border-radius: 6px; margin: 6px 0; }
    .present  { background: var(--green-bg); color: var(--green-text); }
    .absent   { background: var(--red-bg);   color: var(--red-text); }
    .unmarked { background: var(--amber-bg); color: var(--amber-text); }
    em { font-style: italic; opacity: .9; }
  </style>
</head>
<body>
  <nav style="margin-bottom: 12px;">
    <a href="{{ url_for('home') }}">üè† Main Page</a>
  </nav>
  <hr />

  <h1>Attendance History</h1>

  <!-- Date + Team filters (auto-submit on change) -->
  <form class="filters" method="post">
    <label>
      Select Date
      <select name="selected_date" onchange="this.form.submit()">
        {% for date in dates %}
          <option value="{{ date }}" {% if date == selected_date %}selected{% endif %}>{{ date }}</option>
        {% endfor %}
      </select>
    </label>

    <label>
      Select Team
      <select name="team_id" onchange="this.form.submit()">
        <option value="">-- All Teams --</option>
        {% for team in teams %}
          <option value="{{ team[0] }}" {% if team[0] == selected_team_id %}selected{% endif %}>{{ team[1] }}</option>
        {% endfor %}
      </select>
    </label>
  </form>

  <h2 style="margin:.5rem 0 0;">Attendance for {{ selected_date }}</h2>

  <!-- Quick counts (defaults to 0 if route didn't pass them) -->
  <div class="counts">
    <span>Present: <strong>{{ present_count or 0 }}</strong></span>
    <span>Absent: <strong>{{ absent_count or 0 }}</strong></span>
    <span>Unmarked: <strong>{{ unmarked_count or 0 }}</strong></span>
  </div>

  <ul>
    {% for athlete in history_data %}
      {# history_data tuple: (first_name, last_name, status, notes) #}
      {% set status = athlete[2] or 'Unmarked' %}
      <li class="{{ 'present' if status == 'Present' else ('absent' if status == 'Absent' else 'unmarked') }}">
        {{ athlete[0] }} {{ athlete[1] }} ‚Äì {{ status }}
        {% if athlete[3] %}
          <em>(Note: {{ athlete[3] }})</em>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
</body>
</html>
